<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Online Quiz</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        body {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        .navquestions {
            cursor: pointer;
        }

        /* #submittest{
                display: none;
            } */

        .timerbox {
            padding: 7px;
            background-color: #cacaca;
            border-radius: 10px;
            font-weight: 500;
            justify-content: center;
            text-align: center;
            /* margin-bottom: 20px; */
        }

        .navquestions {

            background-color: #fff;
        }

        .innerrow {
            border-bottom: 1px solid #cacaca;
            margin-bottom: 7px;

            padding-bottom: 8px;
        }

        .text-right {
            text-align: right;
        }

        .amrkers-list {
            height: 100vh;
            padding: 10px;
            background-color: #dbeeff;
        }

        #questionconatiner {
            position: relative;
        }

        #questionconatiner .card-title {
            border-bottom: 1px solid #cacaca;
            padding-bottom: 3px;
        }

        .test-buttons {
            position: absolute;
            bottom: 102px;
            width: 98%;
            border-top: 1px solid #cacaca;
            padding-top: 6px;
        }

        .navquestions {
            height: 2.5vw;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1vw;
            width: 2.5vw;
        }


        #mycontainertest {
            display: none;
        }
    </style>

</head>

<body>

    <div id="rules" class="container p-2">

        <div class="form-check">
            <input class="form-check-input" id="accepterms" type="checkbox" value="">
            <label class="form-check-label" for="flexCheckDefault">
                Accept Terms
            </label>
        </div>

        <button id="acceptbtn" class="btn btn-info">Agree and continue</button>
    </div>

    <div class="container-fluid p-4" id="mycontainertest">
        <div class="row innerrow align-items-center">


            <div class="col-md-6">
                <h5 id="questionname">PHP Interview Questions</h5>
            </div>
            <div class="col-md-3">
                <div class="d-flex timerbox">
                    <div class="Time">
                        Time Left:
                    </div>
                    <div id="timer">10:00:00</div>
                </div>

            </div>
            <div class="col-md-3">
                <div class="d-flex align-items-center" style="justify-content: space-between;">
                    <div class="useimg d-flex align-items-center"> <img src="assets/img/icons8-user-30.png"
                            style="margin-right: 10px;" alt="">
                        <div id="nameuser"></div>
                    </div>
                    <div class="text-right">
                        <a href="javascript:void(0)" class="btn btn-outline-info">Switch Full Screen</a>
                    </div>
                </div>


            </div>
        </div>
        <div class="row">
            <div class="col-md-9">

            </div>
            <div class="col-md-12" id="obtmarks">

            </div>
            <div class="col-md-9" id="questionconatiner">
                <div id="container">

                </div>
                <div class="button mt-2 d-flex justify-content-between test-buttons">
                    <div>
                        <button id="previous" class="btn btn-info">Previous</button>
                        <button id="next" class="btn btn-info">Next</button>
                    </div>
                    <div>
                        <button id="marknext" class="btn btn-dark">Mark for review & next</button>
                        <button id="savenext" class="btn btn-success">Save & Next</button>
                        <button id="submittest" class="btn btn-success">Submit test</button>
                    </div>


                </div>

            </div>
            <div class="col-md-3">
                <div class="amrkers-list">
                    <h6>Test</h6>
                    <div id="markers">

                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>

       
        // Acceprt terms

        function showTimer() {
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            const id = urlParams.get('id');
            const xhr = new XMLHttpRequest();
            xhr.open("POST", "codes/timer.php", true);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        const resp = JSON.parse(xhr.response);
                        document.querySelector("#timer").innerHTML = resp.remainingTime;
                        document.querySelector("#questionname").innerHTML = resp.testname;
                        // console.log(resp.remainingTime)
                        const timeParts = resp.remainingTime.split(':');
                        const remainingSeconds = (+timeParts[0]) * 3600 + (+timeParts[1]) * 60 + (+timeParts[2]);

                        if (remainingSeconds <= 0) {
                            alert("Test has ended!")
                            var xhr = new XMLHttpRequest();
                            xhr.open("POST", "test-end.php", true);
                            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                            xhr.onreadystatechange = function () {
                                if (xhr.readyState === XMLHttpRequest.DONE) {
                                    if (xhr.status === 200) {
                                        var resp = JSON.parse(xhr.response);
                                        if (resp.message == 'Test details saved successfully') {
                                            location.href = "my-profile.php";
                                        }

                                    } else {
                                        location.href = "/";
                                        console.error("Error: " + xhr.status);
                                    }
                                }
                            };
                            xhr.send();

                        }
                    }



                    else {
                        reject("Error: " + xhr.status);
                    }

                }
            }

            xhr.send("id=" + encodeURIComponent(id));
        }

        const termsCheckbox = document.getElementById('accepterms');
        const rulesContainer = document.getElementById('rules');
        const testContainer = document.getElementById('mycontainertest');
        document.querySelector("#acceptbtn").addEventListener("click", function () {


            if (termsCheckbox.checked) {
                rulesContainer.style.display = 'none';
                testContainer.style.display = 'block';
                let elem = document.documentElement;
                if (elem.requestFullscreen) {
                    elem.requestFullscreen().catch(err => {
                        console.error(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                    });
                } else if (elem.mozRequestFullScreen) { // Firefox
                    elem.mozRequestFullScreen().catch(err => {
                        console.error(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                    });
                } else if (elem.webkitRequestFullscreen) { // Chrome, Safari and Opera
                    elem.webkitRequestFullscreen().catch(err => {
                        console.error(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                    });
                } else if (elem.msRequestFullscreen) { // IE/Edge
                    elem.msRequestFullscreen().catch(err => {
                        console.error(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                    });
                }
                let timerInterval;
                localStorage.setItem('timerStarted', true);
                timerInterval = setInterval(showTimer, 1000);
                if (!timerInterval && localStorage.getItem('timerStarted')) {
                timerInterval = setInterval(showTimer, 1000);
            }
            } else {
                alert('Please accept the terms to continue.');
            }
        })

        function allQuestions() {
            return new Promise((resolve, reject) => {
                const queryString = window.location.search;
                const urlParams = new URLSearchParams(queryString);
                const id = urlParams.get('id');

                const xhr = new XMLHttpRequest();
                xhr.open("POST", "codes/questions.php", true);
                xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                        if (xhr.status === 200) {
                            try {
                                const resp = JSON.parse(xhr.response);
                                const questions = resp.map(val => ({
                                    "id": val.id,
                                    "quest": val.quest,
                                    "op1": val.op1,
                                    "op2": val.op2,
                                    "op3": val.op3,
                                    "op4": val.op4,
                                    "answer": val.answer,
                                    "state": val.state ? val.state : null,
                                    "selectedans": val.selectedans ? val.selectedans : null
                                }));

                                resolve(questions);
                            } catch (error) {
                                reject("Error parsing response: " + error.message);
                            }
                        } else {
                            reject("Error: " + xhr.status);
                        }
                    }
                };

                xhr.send("id=" + encodeURIComponent(id));
            });
        }


        // setInterval(showTimer, 1000);

        // document.addEventListener('DOMContentLoaded', (event) => {
        //     const startTimerBtn = document.getElementById('startTimerBtn');
        //     let timerInterval;

        //     startTimerBtn.addEventListener('click', () => {
        //         localStorage.setItem('timerStarted', true);
        //         timerInterval = setInterval(showTimer, 1000);
        //     });

        //     if (localStorage.getItem('timerStarted')) {
        //         timerInterval = setInterval(showTimer, 1000);
        //     }
        // });

       


        checkloginStatus();
        function checkloginStatus() {
            // alert(testid);
            // var testid = testid;
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "codes/checklogin.php", true);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        var resp = JSON.parse(xhr.response);
                        if (!resp.loggedIn) {
                            location.href = "/"
                        }
                        else {

                            document.querySelector("#nameuser").innerHTML = resp.userdetails.name;
                        }
                    } else {
                        console.error("Error: " + xhr.status);
                    }
                }
            };
            xhr.send();
        }




        // Using the function





    </script>

    <script src="script.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>